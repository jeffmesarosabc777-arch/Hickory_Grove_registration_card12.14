<!DOCTYPE html>
<!-- saved from url=(0069)file:///C:/Users/JMesaros/Downloads/enhanced_sales_tracker%20(5).html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hickory Grove — Client Survey (Simple, No Login)</title>
  <script src="./Hickory Grove Registratuin tracker 12.12.25_files/saved_resource"></script>
  <link href="./Hickory Grove Registratuin tracker 12.12.25_files/css2" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .fun-font { font-family: 'Pacifico', cursive; }
    .input-style { width:100%; padding:.5rem .75rem; border:1px solid #D1D5DB; border-radius:.5rem; outline:none; }
    .input-style:focus { box-shadow: 0 0 0 4px rgba(59,130,246,.2); border-color:#3B82F6; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.5rem 1rem; border-radius:.5rem; font-weight:600; transition:.15s; }
    .btn-primary { background:#1E3A8A; color:#fff; }
    .btn-primary:hover { background:#1E40AF; }
    .btn-ghost { background:#fff; color:#374151; border:1px solid #D1D5DB; }
    .btn-ghost:hover { background:#F9FAFB; }
    .btn-danger { background:#DC2626; color:#fff; }
    .btn-danger:hover { background:#EF4444; }
    .card { background:#fff; border-radius: .75rem; box-shadow: 0 8px 15px -3px rgba(0,0,0,.1), 0 4px 6px -4px rgba(0,0,0,.06); border-top:4px solid #1E3A8A; }
    .section { padding:1.25rem; border:1px solid #E5E7EB; border-radius:.75rem; }
    .input-error { box-shadow: 0 0 0 3px rgba(239,68,68,.35) !important; border-color:#EF4444 !important; }
  </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.absolute{position:absolute}.sticky{position:sticky}.inset-0{inset:0px}.right-0{right:0px}.top-0{top:0px}.z-30{z-index:30}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.-mt-1{margin-top:-0.25rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.ml-auto{margin-left:auto}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-5{height:1.25rem}.h-full{height:100%}.min-h-screen{min-height:100vh}.\!w-auto{width:auto !important}.w-10{width:2.5rem}.w-5{width:1.25rem}.w-full{width:100%}.max-w-6xl{max-width:72rem}.max-w-xl{max-width:36rem}.table-auto{table-layout:auto}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;user-select:none}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-8{grid-template-columns:repeat(8, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.place-content-center{place-content:center}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.divide-y > :not([hidden]) ~ :not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-amber-200{--tw-border-opacity:1;border-color:rgb(253 230 138 / var(--tw-border-opacity, 1))}.border-emerald-200{--tw-border-opacity:1;border-color:rgb(167 243 208 / var(--tw-border-opacity, 1))}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-indigo-200{--tw-border-opacity:1;border-color:rgb(199 210 254 / var(--tw-border-opacity, 1))}.border-rose-200{--tw-border-opacity:1;border-color:rgb(254 205 211 / var(--tw-border-opacity, 1))}.bg-amber-50{--tw-bg-opacity:1;background-color:rgb(255 251 235 / var(--tw-bg-opacity, 1))}.bg-black\/30{background-color:rgb(0 0 0 / 0.3)}.bg-blue-900{--tw-bg-opacity:1;background-color:rgb(30 58 138 / var(--tw-bg-opacity, 1))}.bg-emerald-50{--tw-bg-opacity:1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-indigo-50{--tw-bg-opacity:1;background-color:rgb(238 242 255 / var(--tw-bg-opacity, 1))}.bg-rose-50{--tw-bg-opacity:1;background-color:rgb(255 241 242 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/90{background-color:rgb(255 255 255 / 0.9)}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pt-2{padding-top:0.5rem}.pt-4{padding-top:1rem}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-semibold{font-weight:600}.tracking-tight{letter-spacing:-0.025em}.text-amber-800{--tw-text-opacity:1;color:rgb(146 64 14 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-blue-900{--tw-text-opacity:1;color:rgb(30 58 138 / var(--tw-text-opacity, 1))}.text-emerald-800{--tw-text-opacity:1;color:rgb(6 95 70 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-indigo-800{--tw-text-opacity:1;color:rgb(55 48 163 / var(--tw-text-opacity, 1))}.text-rose-500{--tw-text-opacity:1;color:rgb(244 63 94 / var(--tw-text-opacity, 1))}.text-rose-700{--tw-text-opacity:1;color:rgb(190 18 60 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.backdrop-blur{--tw-backdrop-blur:blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}@media (min-width: 640px){.sm\:w-auto{width:auto}}@media (min-width: 768px){.md\:col-span-2{grid-column:span 2 / span 2}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.md\:flex-row{flex-direction:row}.md\:items-center{align-items:center}.md\:justify-between{justify-content:space-between}}@media (min-width: 1024px){.lg\:flex-row{flex-direction:row}.lg\:items-end{align-items:flex-end}}</style></head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header / Nav -->
  <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-full bg-blue-900 text-white grid place-content-center font-extrabold">HG</div>
        <div>
          <h1 class="text-xl font-extrabold tracking-tight text-blue-900 fun-font">Hickory Grove</h1>
          <p class="text-xs text-gray-500 -mt-1">Mattamy Homes • Winter Springs</p>
        </div>
      </div>
      <nav class="flex items-center gap-2">
        <button id="tabSurvey" class="btn btn-ghost" aria-selected="true">Survey</button>
        <!-- Hide the original Admin tab so it can't be clicked directly -->
        <button id="tabAdmin" class="btn btn-ghost hidden">Admin</button>
        <!-- Toggle switch to control Admin mode -->
        <label class="inline-flex items-center cursor-pointer select-none gap-2">
          <span class="text-sm font-semibold">Admin</span>
          <input id="toggleAdmin" type="checkbox" class="h-5 w-5 text-blue-700 rounded border-gray-300">
        </label>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Status bar -->
    <div id="statusMessage" class="hidden mb-4 p-3 rounded-lg font-semibold"></div>

    <!-- SURVEY PANEL -->
    <section id="panelSurvey" class="card p-6">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-extrabold text-blue-900 fun-font">Let's Begin Your Journey</h2>
        <p class="text-gray-600">Mattamy Homes — Hickory Grove</p>
      </div>

      <form id="clientForm" class="space-y-6">
        <!-- Date/Time -->
        <div class="section border-gray-200 bg-gray-50">
          <label class="block text-sm font-bold text-gray-700">Date &amp; Time (auto)</label>
          <input type="datetime-local" id="submissionDateTime" name="submissionDateTime" class="input-style mt-2">
        </div>

        <!-- Contact & Status -->
        <div class="section border-indigo-200 bg-indigo-50" data-section="Contact &amp; Status">
          <h3 class="text-xl font-bold text-indigo-800 mb-4">1) Client Contact &amp; Status</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-semibold text-gray-700">Primary Buyer Full Name</label>
              <input id="buyer1Name" name="buyer1Name" class="input-style mt-1" type="text">
            </div>
            <div>
              <label class="font-semibold text-gray-700">Secondary Buyer Name (Optional)</label>
              <input id="buyer2Name" name="buyer2Name" class="input-style mt-1" type="text">
            </div>
            <div>
              <label class="font-semibold text-gray-700">Email Address<span class="text-rose-500"> *</span></label>
              <input id="email" name="email" class="input-style mt-1" type="email" required="">
            </div>
            <div>
              <label class="font-semibold text-gray-700">Phone<span class="text-rose-500"> *</span></label>
              <input id="phone" name="phone" class="input-style mt-1" type="tel" placeholder="(XXX) XXX-XXXX" required="">
            </div>
          </div>

          <div class="mt-4">
            <label class="font-semibold text-gray-700">Preferred Contact Method(s)</label>
            <div class="flex flex-wrap gap-3 pt-2">
              <label class="inline-flex items-center gap-2"><input type="checkbox" name="preferredContactMethod" value="Phone">Phone</label>
              <label class="inline-flex items-center gap-2"><input type="checkbox" name="preferredContactMethod" value="Email">Email</label>
              <label class="inline-flex items-center gap-2"><input type="checkbox" name="preferredContactMethod" value="Text">Text</label>
            </div>
          </div>

          <div class="mt-4" data-required-group="clientStatus">
            <label class="font-semibold text-gray-700">Client Status<span class="text-rose-500"> *</span></label>
            <div class="flex flex-wrap gap-4 pt-2" id="clientStatusContainer">
              <label class="inline-flex items-center gap-2"><input type="radio" name="clientStatus" id="statusNoRealtor" value="NoRealtor" required="">Client (No Realtor)</label>
              <label class="inline-flex items-center gap-2"><input type="radio" name="clientStatus" id="statusWithRealtor" value="WithRealtor">Client (With Realtor)</label>
            </div>
          </div>

          <div id="realtorContainer" class="hidden mt-3">
            <label class="font-semibold text-gray-700">Referring Realtor Name</label>
            <input id="realtorName" name="realtorName" class="input-style mt-1" type="text">
          </div>

          <div class="mt-4">
            <label class="font-semibold text-gray-700">How did you hear about us?</label>
            <div class="flex flex-wrap gap-4 pt-2">
              <label class="inline-flex items-center gap-2"><input type="radio" name="leadSource" value="GoogleSearch">Google Search</label>
              <label class="inline-flex items-center gap-2"><input type="radio" name="leadSource" value="SocialMedia">Social Media</label>
              <label class="inline-flex items-center gap-2"><input type="radio" name="leadSource" value="PastClient">Past Client Referral</label>
              <label class="inline-flex items-center gap-2"><input type="radio" name="leadSource" value="DriveBy">Drive By / Signage</label>
              <label class="inline-flex items-center gap-2"><input type="radio" name="leadSource" value="Other">Other</label>
            </div>
          </div>
        </div>

        <!-- Financial -->
        <div class="section border-emerald-200 bg-emerald-50" data-section="Financial Comfort Zone">
          <h3 class="text-xl font-bold text-emerald-800 mb-4">2) Financial Comfort Zone</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="font-semibold text-gray-700">Max Home Budget ($)<span class="text-rose-500"> *</span></label>
              <input id="budget" name="budget" class="input-style mt-1" type="text" placeholder="$500,000" required="">
            </div>
            <div>
              <label class="font-semibold text-gray-700">Target Monthly ($)<span class="text-rose-500"> *</span></label>
              <input id="monthlyPaymentTarget" name="monthlyPaymentTarget" class="input-style mt-1" type="text" placeholder="$3,500" required="">
            </div>
            <div>
              <label class="font-semibold text-gray-700">Stretch Monthly ($)<span class="text-rose-500"> *</span></label>
              <input id="monthlyPaymentStretch" name="monthlyPaymentStretch" class="input-style mt-1" type="text" placeholder="$4,500" required="">
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div data-required-group="preApprovalStatus">
              <label class="font-semibold text-gray-700">Pre-Approval Status<span class="text-rose-500"> *</span></label>
              <div class="flex flex-wrap gap-4 pt-2">
                <label class="inline-flex items-center gap-2"><input type="radio" name="preApprovalStatus" value="Pre-Approved" required="">Fully Pre-Approved</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="preApprovalStatus" value="Pre-Qualified">Pre-Qualified</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="preApprovalStatus" value="NeedsApproval">Needs Approval</label>
              </div>
            </div>
            <div data-required-group="loanType">
              <label class="font-semibold text-gray-700">Loan Type<span class="text-rose-500"> *</span></label>
              <div class="flex flex-wrap gap-4 pt-2">
                <label class="inline-flex items-center gap-2"><input type="radio" name="loanType" value="Conventional" required="">Conventional</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="loanType" value="FHA">FHA</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="loanType" value="VA">VA</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="loanType" value="Cash">Cash</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="loanType" value="Unknown">Unknown/Other</label>
              </div>
            </div>
            <div>
              <label class="font-semibold text-gray-700">Down Payment (amt or %)</label>
              <input id="downPayment" name="downPayment" class="input-style mt-1" type="text" placeholder="$50,000 or 20%">
            </div>
          </div>
        </div>

        <!-- Housing Needs -->
        <div class="section border-amber-200 bg-amber-50" data-section="Housing Needs &amp; Timeline">
          <h3 class="text-xl font-bold text-amber-800 mb-4">3) Housing Needs &amp; Timeline</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-semibold text-gray-700">Buyer Profile</label>
              <div class="flex flex-wrap gap-4 pt-2">
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="buyerProfile" value="FirstTime">First-Time</label>
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="buyerProfile" value="MoveUp">Move-Up</label>
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="buyerProfile" value="Investor">Investor</label>
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="buyerProfile" value="Retiree">Retiree/Downsize</label>
              </div>
            </div>
            <div>
              <label class="font-semibold text-gray-700">Primary Motivation</label>
              <div class="flex flex-wrap gap-4 pt-2">
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="purchaseMotivation" value="JobRelocation">Job Relocation</label>
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="purchaseMotivation" value="GrowingFamily">Growing Family</label>
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="purchaseMotivation" value="LifestyleChange">Lifestyle</label>
                <label class="inline-flex items-center gap-2"><input type="checkbox" name="purchaseMotivation" value="Investment">Investment</label>
              </div>
            </div>
            <div data-required-group="minBedrooms">
              <label class="font-semibold text-gray-700">Minimum Floorplan<span class="text-rose-500"> *</span></label>
              <div class="flex flex-wrap gap-4 pt-2">
                <label class="inline-flex items-center gap-2"><input type="radio" name="minBedrooms" value="3_2.5_Bath" required="">3 Bed, 2.5 Bath</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="minBedrooms" value="3_2.5_Bath_Loft">3 Bed + Loft</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="minBedrooms" value="4_Bedroom">4 Bedrooms</label>
              </div>
            </div>
            <div data-required-group="moveInWindow">
              <label class="font-semibold text-gray-700">Desired Move-In Window<span class="text-rose-500"> *</span></label>
              <div class="flex flex-wrap gap-4 pt-2">
                <label class="inline-flex items-center gap-2"><input type="radio" name="moveInWindow" value="0-3" required="">0–3 Months</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="moveInWindow" value="4-6">4–6 Months</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="moveInWindow" value="6+">6+ Months</label>
              </div>
            </div>
            <div class="md:col-span-2">
              <label class="font-semibold text-gray-700">Timing Constraints (lease, school, etc.)</label>
              <input id="timingConstraints" name="timingConstraints" class="input-style mt-1" type="text">
            </div>
          </div>
        </div>

        <!-- Current Situation -->
        <div class="section border-rose-200 bg-rose-50" data-section="Current Living Situation">
          <h3 class="text-xl font-bold text-rose-700 mb-4">4) Current Living Situation</h3>
          <div data-required-group="currentSituation">
            <label class="font-semibold text-gray-700">Select all that apply<span class="text-rose-500"> *</span></label>
            <div class="flex flex-wrap gap-4 pt-2">
              <label class="inline-flex items-center gap-2"><input type="checkbox" id="situationRenting" name="currentSituation" value="Renting">Renting</label>
              <label class="inline-flex items-center gap-2"><input type="checkbox" id="situationOwning" name="currentSituation" value="Owning">Owning</label>
              <label class="inline-flex items-center gap-2"><input type="checkbox" id="situationOther" name="currentSituation" value="Other">Other / With Family</label>
            </div>
          </div>

          <!-- Renting Details -->
          <div id="rentingDetails" class="hidden mt-4 p-4 bg-white border rounded-lg">
            <label class="font-semibold text-gray-700">Lease Expiration</label>
            <input id="leaseExpiration" name="leaseExpiration" class="input-style mt-1" type="date">
          </div>

          <!-- Owning Details -->
          <div id="owningDetails" class="hidden mt-4 p-4 bg-white border rounded-lg">
            <h4 class="font-semibold text-gray-800 mb-2">Owning &amp; Selling</h4>
            <div id="ownerNeedToSellGroup" class="space-y-3">
              <label class="font-semibold text-gray-700">Need to sell current home?</label>
              <div class="flex flex-wrap gap-4">
                <label class="inline-flex items-center gap-2"><input type="radio" name="ownerNeedToSell" id="sellNo" value="NoNeedToSell">No</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="ownerNeedToSell" id="sellYes" value="NeedToSell">Yes</label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="ownerNeedToSell" id="sellConsidering" value="Considering">Considering</label>
              </div>
            </div>

            <div id="sellingSubDetails" class="hidden mt-4 p-4 bg-gray-50 border rounded-lg">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div id="isListedGroup">
                  <label class="font-semibold text-gray-700">Is the home listed?</label>
                  <div class="flex gap-4 pt-2">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="isListed" id="listedNo" value="No">No</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="isListed" id="listedYes" value="Yes">Yes</label>
                  </div>
                </div>
                <div>
                  <label class="font-semibold text-gray-700">How long listed?</label>
                  <input id="listingDuration" name="listingDuration" class="input-style mt-1" type="text" placeholder="30 days, 2 months">
                </div>
                <div id="isUnderContractGroup">
                  <label class="font-semibold text-gray-700">Under contract?</label>
                  <div class="flex gap-4 pt-2">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="isUnderContract" id="contractNo" value="No">No</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="isUnderContract" id="contractYes" value="Yes">Yes</label>
                  </div>
                </div>
                <div id="contractCloseDateContainer" class="hidden">
                  <label class="font-semibold text-gray-700">Contract Close Date</label>
                  <input id="contractClosingDate" name="contractClosingDate" class="input-style mt-1" type="date">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notes -->
        <div class="section border-gray-200 bg-white">
          <h3 class="text-xl font-bold text-gray-800 mb-4">5) Final Notes</h3>
          <textarea id="notes" name="notes" rows="4" class="input-style" placeholder="Any other details or requests..."></textarea>
        </div>

        <div class="pt-2">
          <button id="submitButtonEl" class="btn btn-primary w-full sm:w-auto" type="submit">Submit</button>
        </div>
      </form>
    </section>

    <!-- ADMIN PANEL (No login, local-only) -->
    <section id="panelAdmin" class="hidden">
      <div class="card p-6">
        <div class="flex flex-col lg:flex-row lg:items-end gap-4 justify-between">
          <div>
            <h2 class="text-2xl font-extrabold text-blue-900">Admin — Submissions (Saved on this computer)</h2>
            <p class="text-sm text-gray-600">No sign-in needed. Use Export CSV for backup.</p>
          </div>
          <div class="flex items-center gap-2">
            <button id="btnClearAll" class="btn btn-danger">Clear All</button>
          </div>
        </div>
      </div>

      <!-- Admin Tools Container: mimic mini app style by removing card styling -->
      <!-- Admin Tools Container: styled to match the simpler mini sales tracker look -->
      <div id="adminTools" class="mt-4 p-4 bg-white">
        <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
          <div class="flex items-center gap-2">
            <input id="searchInput" class="input-style" placeholder="Search name, email, phone...">
            <button id="btnRefresh" class="btn btn-ghost">Refresh</button>
            <button id="btnExport" class="btn btn-ghost">Export CSV</button>
          </div>
          <div class="text-sm text-gray-500">Showing <span id="countSpan">0</span> submissions</div>
        </div>

        <!-- Filters similar to mini sales tracker -->
        <div class="mt-4">
          <div class="flex items-center gap-2 mb-2">
            <label for="adminFilterStageTop" class="font-semibold">Filter by Stage:</label>
            <select id="adminFilterStageTop" class="input-style !w-auto">
              <option value="">All</option>
              <option value="New">New</option>
              <option value="Contacted">Contacted</option>
              <option value="Appt Set">Appt Set</option>
              <option value="Nurture">Nurture</option>
              <option value="Closed Won">Closed Won</option>
              <option value="Closed Lost">Closed Lost</option>
            </select>
          </div>
          <div class="grid grid-cols-8 gap-2 mb-4">
            <input id="adminFilterName" class="input-style" placeholder="Name">
            <input id="adminFilterPhone" class="input-style" placeholder="Phone">
            <input id="adminFilterEmail" class="input-style" placeholder="Email">
            <!-- Stage filter within row for quick access -->
            <select id="adminFilterStage" class="input-style">
              <option value="">Stage</option>
              <option value="New">New</option>
              <option value="Contacted">Contacted</option>
              <option value="Appt Set">Appt Set</option>
              <option value="Nurture">Nurture</option>
              <option value="Closed Won">Closed Won</option>
              <option value="Closed Lost">Closed Lost</option>
            </select>
            <select id="adminFilterHeat" class="input-style">
              <option value="">Heat</option>
              <option value="Cold">Cold</option>
              <option value="Warm">Warm</option>
              <option value="Hot">Hot</option>
            </select>
            <input id="adminFilterNextFollow" type="date" class="input-style">
            <select id="adminFilterSource" class="input-style">
              <option value="">Lead Source</option>
              <option value="GoogleSearch">Google Search</option>
              <option value="SocialMedia">Social Media</option>
              <option value="PastClient">Past Client Referral</option>
              <option value="DriveBy">Drive By / Signage</option>
              <option value="Other">Other</option>
            </select>
            <select id="adminFilterType" class="input-style">
              <option value="">Buyer Type</option>
              <option value="FirstTime">FirstTime</option>
              <option value="MoveUp">MoveUp</option>
              <option value="MoveDown">MoveDown</option>
              <option value="Investor">Investor</option>
              <option value="Relocation">Relocation</option>
              <option value="PaymentFirst">PaymentFirst</option>
            </select>
          </div>
          <table class="w-full text-xs border table-auto">
            <thead>
              <!-- Darker blue header similar to mini app -->
              <tr class="text-left bg-blue-900 text-white">
                <th class="p-3">Name</th>
                <th class="p-3">Phone</th>
                <th class="p-3">Email</th>
                <th class="p-3">Stage</th>
                <th class="p-3">Heat</th>
                <th class="p-3">Next Follow-Up</th>
                <th class="p-3">Source</th>
                <th class="p-3">Type</th>
                <th class="p-3">Last Note</th>
                <th class="p-3"></th>
              </tr>
            </thead>
            <tbody id="submissionsBody" class="divide-y"></tbody>
          </table>
        </div>
      </div>

      <!-- Drawer / Modal -->
      <div id="drawer" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-black/30" id="drawerBackdrop"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-xl bg-white shadow-xl p-6 overflow-y-auto">
          <div class="flex items-start justify-between gap-3">
            <h3 class="text-xl font-bold">Submission Details</h3>
            <button id="btnCloseDrawer" class="btn btn-ghost">Close</button>
          </div>
          <div id="drawerContent" class="mt-4 space-y-4 text-sm"></div>
          <div class="mt-6 border-t pt-4">
            <label class="font-semibold">Internal Notes (private)</label>
            <textarea id="internalNotes" rows="4" class="input-style mt-1" placeholder="Follow-ups, call notes, next steps..."></textarea>
            <div class="mt-3 flex flex-wrap items-center gap-2">
              <label class="font-semibold">Follow-up Status:</label>
              <select id="followUpStatus" class="input-style !w-auto">
                <option value="New">New</option>
                <option value="Contacted">Contacted</option>
                <option value="Appt Set">Appt Set</option>
                <option value="Nurture">Nurture</option>
                <option value="Closed Won">Closed Won</option>
                <option value="Closed Lost">Closed Lost</option>
              </select>
              <label class="font-semibold">Heat Level:</label>
              <select id="heatLevel" class="input-style !w-auto">
                <option value="">None</option>
                <option value="Cold">Cold</option>
                <option value="Warm">Warm</option>
                <option value="Hot">Hot</option>
              </select>
              <label class="font-semibold">Next Follow-Up:</label>
              <input id="nextFollowUpDate" type="date" class="input-style !w-auto">
              <button id="btnSaveNotes" class="btn btn-primary">Save</button>
              <button id="btnDelete" class="btn btn-danger ml-auto">Delete</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- SIMPLE LOCAL STORAGE (No Firebase) -->
  <script>
    // ======= Helpers =======
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    function setStatus(msg, type = 'info'){
      const el = $('#statusMessage');
      el.className = 'mb-4 p-3 rounded-lg font-semibold';
      if (!msg) { el.classList.add('hidden'); el.textContent=''; return; }
      el.classList.remove('hidden');
      if (type==='success') el.classList.add('bg-emerald-100','text-emerald-900','border','border-emerald-300');
      else if (type==='error') el.classList.add('bg-rose-100','text-rose-900','border','border-rose-300');
      else el.classList.add('bg-blue-50','text-blue-900','border','border-blue-200');
      el.innerHTML = msg;
      if (type==='success') setTimeout(()=>setStatus(''), 4000);
    }

    function fmtCurrencyStr(val){
      if (!val) return '';
      const n = parseInt(String(val).replace(/[$,\s,]/g,''),10);
      if (isNaN(n)) return String(val);
      return '$' + n.toLocaleString('en-US');
    }

    // Get last note snippet: returns the last non-empty line of notes (internal or public), truncated
    function getLastNoteSnippet(d, maxLen = 60){
      const raw = (d.internalNotes || d.notes || '').trim();
      if (!raw) return '';
      const lines = raw.split('\n').filter(l => l.trim() !== '');
      if (lines.length === 0) return '';
      const last = lines[lines.length - 1];
      return last.length > maxLen ? last.slice(0, maxLen) + '…' : last;
    }

    function formatPhoneInput(e){
      let input = e.target.value.replace(/\D/g,'');
      let out = '';
      if (input.length>0) out += '('+input.slice(0,3);
      if (input.length>3) out += ') ' + input.slice(3,6);
      if (input.length>6) out += '-' + input.slice(6,10);
      e.target.value = out;
    }

    function setNow(){
      const now = new Date();
      $('#submissionDateTime').value = now.toISOString().slice(0,16);
    }

    function toggle(sel, show){ $(sel).classList.toggle('hidden', !show); }

    // ======= Local Storage Layer =======
    const STORAGE_KEY = 'hg_client_surveys_v1';
    const loadAll = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; } };
    const saveAll = (arr) => localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    const newId = () => (crypto && crypto.randomUUID) ? crypto.randomUUID() : 'id_'+Date.now()+Math.random().toString(36).slice(2);

    // ======= Validation =======
    function getRadioValue(name){ const el = document.querySelector(`input[name="${name}"]:checked`); return el ? el.value : ''; }

    function validateRequiredFields(){
      let valid = true; $$('.input-error').forEach(el=>el.classList.remove('input-error'));
      $$('#clientForm [required]').forEach(el=>{ if(el.type!== 'radio' && String(el.value).trim()===''){ el.classList.add('input-error'); valid=false; }});
      $$('#clientForm [data-required-group]').forEach(group=>{
        const name = group.getAttribute('data-required-group');
        if (name==='currentSituation') return;
        const checked = document.querySelectorAll(`#clientForm input[name="${name}"]:checked`).length;
        if(!checked){ group.querySelector('div').classList.add('input-error'); valid=false; }
      });
      if (document.querySelectorAll('input[name="currentSituation"]:checked').length===0){
        document.querySelector('[data-required-group="currentSituation"] div').classList.add('input-error');
        valid=false;
      }
      if(!valid) setStatus('Please complete the highlighted required fields.', 'error');
      return valid;
    }

    // ======= Submit =======
    async function submitForm(e){
      e.preventDefault();
      if(!validateRequiredFields()) return;
      const btn = $('#submitButtonEl'); btn.disabled=true; btn.textContent='Submitting...';
      try{
        const fd = new FormData($('#clientForm'));
        const data = {};
        for(const [k,v] of fd.entries()){
          if (data[k] && Array.isArray(data[k])) data[k].push(v);
          else if (data[k] && typeof data[k]==='string') data[k] = [data[k], v];
          else data[k] = v;
        }
        // checkbox groups as pipes
        $$('input[type="checkbox"]').forEach(cb=>{
          const all = fd.getAll(cb.name);
          if (all.length>1) data[cb.name] = all.join('|');
        });
        // numeric clean
        ['budget','monthlyPaymentTarget','monthlyPaymentStretch','downPayment'].forEach(k=>{
          if(data[k]) data[k] = String(data[k]).replace(/[$,\s]/g,'');
        });
        data.submissionTimestamp = new Date().toISOString();
        data.id = newId();

        const all = loadAll();
        all.unshift(data);
        saveAll(all);

        setStatus('Success! Saved on this computer.', 'success');
        $('#clientForm').reset(); setNow();
        // reset dynamic areas
        toggle('#realtorContainer', false);
        toggle('#rentingDetails', false);
        toggle('#owningDetails', false);
        toggle('#sellingSubDetails', false);
        toggle('#contractCloseDateContainer', false);
      }catch(err){ setStatus('Submission failed: '+err.message, 'error'); }
      finally{ btn.disabled=false; btn.textContent='Submit'; }
    }

    // ======= Dynamics =======
    function onClientStatusChange(){ const s = getRadioValue('clientStatus'); toggle('#realtorContainer', s==='WithRealtor'); if(s!=='WithRealtor') $('#realtorName').value=''; }
    function onSituationChange(){ const r=$('#situationRenting').checked; const o=$('#situationOwning').checked; toggle('#rentingDetails', r); toggle('#owningDetails', o); if(!o) toggle('#sellingSubDetails', false); }
    function onSellingChange(){ const need = getRadioValue('ownerNeedToSell'); toggle('#sellingSubDetails', need==='NeedToSell'); if(need!=='NeedToSell') toggle('#contractCloseDateContainer', false); }
    function onUnderContractChange(){ const u = getRadioValue('isUnderContract'); toggle('#contractCloseDateContainer', u==='Yes'); }
    function onCurrencyInput(e){ const raw = e.target.value.replace(/[$,\s]/g,''); if(!raw) return; const n=parseInt(raw,10); if(Number.isNaN(n)) return; e.target.value = '$' + n.toLocaleString('en-US'); }

    // ======= Admin (Local) =======
    let currentDocs = [];
    let activeId = null;

    function loadSubmissions(){
      const tbody = $('#submissionsBody');
      tbody.innerHTML='';
      currentDocs = loadAll();
      currentDocs.forEach(d=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3 whitespace-nowrap">${d.buyer1Name || ''}</td>
          <td class="p-3 whitespace-nowrap">${d.phone || ''}</td>
          <td class="p-3 whitespace-nowrap">${d.email || ''}</td>
          <td class="p-3 whitespace-nowrap">${d.followUpStatus || 'New'}</td>
          <td class="p-3 whitespace-nowrap">${d.heatLevel || ''}</td>
          <td class="p-3 whitespace-nowrap">${d.nextFollowUpDate || ''}</td>
          <td class="p-3 whitespace-nowrap">${d.leadSource || ''}</td>
          <td class="p-3 whitespace-nowrap">${d.buyerProfile || ''}</td>
          <td class="p-3 whitespace-nowrap">${getLastNoteSnippet(d, 25)}</td>
          <td class="p-3 whitespace-nowrap text-right"><button class="btn btn-ghost" data-id="${d.id}">View</button></td>`;
        tbody.appendChild(tr);
      });
      $('#countSpan').textContent = String(currentDocs.length);
      $$('#submissionsBody [data-id]').forEach(btn=>btn.addEventListener('click', ()=>openDrawer(btn.getAttribute('data-id'))));
    }

    function renderTable(items){
      const tbody = $('#submissionsBody');
      tbody.innerHTML='';
      items.forEach(d=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2 whitespace-nowrap">${d.buyer1Name || ''}</td>
          <td class="p-2 whitespace-nowrap">${d.phone || ''}</td>
          <td class="p-2 whitespace-nowrap">${d.email || ''}</td>
          <td class="p-2 whitespace-nowrap">${d.followUpStatus || 'New'}</td>
          <td class="p-2 whitespace-nowrap">${d.heatLevel || ''}</td>
          <td class="p-2 whitespace-nowrap">${d.nextFollowUpDate || ''}</td>
          <td class="p-2 whitespace-nowrap">${d.leadSource || ''}</td>
          <td class="p-2 whitespace-nowrap">${d.buyerProfile || ''}</td>
          <td class="p-2 whitespace-nowrap">${getLastNoteSnippet(d, 25)}</td>
          <td class="p-2 whitespace-nowrap text-right"><button class="btn btn-ghost" data-id="${d.id}">View</button></td>`;
        tbody.appendChild(tr);
      });
      $('#countSpan').textContent = String(items.length);
      $$('#submissionsBody [data-id]').forEach(btn=>btn.addEventListener('click', ()=>openDrawer(btn.getAttribute('data-id'))));
    }

    function filterSubmissions(q){
      // This legacy function is retained for compatibility but now simply forwards to applyAdminFilters
      applyAdminFilters();
    }

    // Apply filters and search to currentDocs and render
    function applyAdminFilters(){
      let items = currentDocs.slice();
      // Text search across name, email, phone
      const search = $('#searchInput').value.trim().toLowerCase();
      if (search) {
        items = items.filter(d => {
          const values = [d.buyer1Name || '', d.email || '', d.phone || ''];
          return values.some(v => v.toLowerCase().includes(search));
        });
      }
      // Individual filters
      const nameFilter = $('#adminFilterName').value.trim().toLowerCase();
      if (nameFilter) {
        items = items.filter(d => (d.buyer1Name || '').toLowerCase().includes(nameFilter));
      }
      const phoneFilter = $('#adminFilterPhone').value.trim().toLowerCase();
      if (phoneFilter) {
        items = items.filter(d => (d.phone || '').toLowerCase().includes(phoneFilter));
      }
      const emailFilter = $('#adminFilterEmail').value.trim().toLowerCase();
      if (emailFilter) {
        items = items.filter(d => (d.email || '').toLowerCase().includes(emailFilter));
      }
      // Stage filter: prefer row-level, fallback to top-level
      const stageRow = $('#adminFilterStage').value;
      const stageTop = $('#adminFilterStageTop').value;
      const stageFilter = stageRow || stageTop;
      if (stageFilter) {
        items = items.filter(d => (d.followUpStatus || 'New') === stageFilter);
      }
      const heatFilter = $('#adminFilterHeat').value;
      if (heatFilter) {
        items = items.filter(d => (d.heatLevel || '') === heatFilter);
      }
      const nextFollow = $('#adminFilterNextFollow').value;
      if (nextFollow) {
        items = items.filter(d => (d.nextFollowUpDate || '') === nextFollow);
      }
      const sourceFilter = $('#adminFilterSource').value;
      if (sourceFilter) {
        items = items.filter(d => (d.leadSource || '') === sourceFilter);
      }
      const typeFilter = $('#adminFilterType').value;
      if (typeFilter) {
        items = items.filter(d => (d.buyerProfile || '') === typeFilter);
      }
      renderTable(items);
    }

    function openDrawer(id){
      const d = currentDocs.find(x=>x.id===id);
      if(!d) return;
      activeId = id;
      $('#drawerContent').innerHTML = `
        <div class="grid grid-cols-2 gap-3">
          <div><div class="text-gray-500">Submitted</div><div class="font-semibold">${d.submissionTimestamp ? new Date(d.submissionTimestamp).toLocaleString() : ''}</div></div>
          <div><div class="text-gray-500">Email</div><div class="font-semibold break-all">${d.email || ''}</div></div>
          <div><div class="text-gray-500">Buyer</div><div class="font-semibold">${d.buyer1Name || ''}</div></div>
          <div><div class="text-gray-500">Phone</div><div class="font-semibold">${d.phone || ''}</div></div>
          <div><div class="text-gray-500">Budget</div><div class="font-semibold">${fmtCurrencyStr(d.budget)}</div></div>
          <div><div class="text-gray-500">Target / Stretch</div><div class="font-semibold">${fmtCurrencyStr(d.monthlyPaymentTarget)} / ${fmtCurrencyStr(d.monthlyPaymentStretch)}</div></div>
          <div><div class="text-gray-500">Client Status</div><div class="font-semibold">${d.clientStatus || ''}</div></div>
          <div><div class="text-gray-500">Realtor</div><div class="font-semibold">${d.realtorName || ''}</div></div>
          <div class="col-span-2"><div class="text-gray-500">Buyer Profile</div><div class="font-semibold">${d.buyerProfile || ''}</div></div>
          <div class="col-span-2"><div class="text-gray-500">Motivation</div><div class="font-semibold">${d.purchaseMotivation || ''}</div></div>
          <div><div class="text-gray-500">Min Floorplan</div><div class="font-semibold">${d.minBedrooms || ''}</div></div>
          <div><div class="text-gray-500">Move-In</div><div class="font-semibold">${d.moveInWindow || ''}</div></div>
          <div class="col-span-2"><div class="text-gray-500">Timing Constraints</div><div class="font-semibold">${d.timingConstraints || ''}</div></div>
          <div class="col-span-2"><div class="text-gray-500">Living Situation</div><div class="font-semibold">${d.currentSituation || ''}</div></div>
          <div><div class="text-gray-500">Lease Exp.</div><div class="font-semibold">${d.leaseExpiration || ''}</div></div>
          <div><div class="text-gray-500">Listed?</div><div class="font-semibold">${d.isListed || ''}</div></div>
          <div><div class="text-gray-500">Under Contract?</div><div class="font-semibold">${d.isUnderContract || ''}</div></div>
          <div><div class="text-gray-500">Contract Close</div><div class="font-semibold">${d.contractClosingDate || ''}</div></div>
          <div class="col-span-2"><div class="text-gray-500">Notes</div><div class="font-semibold whitespace-pre-wrap">${d.notes || ''}</div></div>
        </div>`;
      $('#internalNotes').value = d.internalNotes || '';
      $('#followUpStatus').value = d.followUpStatus || 'New';
      // Set heat level and next follow-up date if available
      $('#heatLevel').value = d.heatLevel || '';
      $('#nextFollowUpDate').value = d.nextFollowUpDate || '';
      $('#drawer').classList.remove('hidden');
    }

    function saveNotes(){
      if(!activeId) return;
      const all = loadAll();
      const idx = all.findIndex(x=>x.id===activeId);
      if(idx===-1) return;
      all[idx].internalNotes = $('#internalNotes').value;
      all[idx].followUpStatus = $('#followUpStatus').value;
      // Save heat level and next follow-up date
      all[idx].heatLevel = $('#heatLevel').value;
      all[idx].nextFollowUpDate = $('#nextFollowUpDate').value;
      saveAll(all);
      setStatus('Saved notes.', 'success');
      loadSubmissions();
      applyAdminFilters();
    }

    function deleteCurrent(){
      if(!activeId) return;
      if(!confirm('Delete this submission? This cannot be undone.')) return;
      const all = loadAll().filter(x=>x.id!==activeId);
      saveAll(all);
      $('#drawer').classList.add('hidden');
      setStatus('Submission deleted.', 'success');
      loadSubmissions();
      applyAdminFilters();
    }

    function exportCSV(){
      const headers = ['submissionTimestamp','buyer1Name','email','phone','budget','monthlyPaymentTarget','monthlyPaymentStretch','clientStatus','realtorName','buyerProfile','purchaseMotivation','minBedrooms','moveInWindow','timingConstraints','currentSituation','leaseExpiration','isListed','isUnderContract','contractCloseDate','notes','internalNotes','followUpStatus'];
      const rows = [headers.join(',')];
      (loadAll()).forEach(d=>{
        const line = headers.map(h => '"'+(d[h]? String(d[h]).replace(/"/g,'""') : '')+'"').join(',');
        rows.push(line);
      });
      const blob = new Blob([rows.join('\n')], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='hickory-grove-client-submissions.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function clearAll(){
      if(!confirm('Clear ALL submissions saved on this computer?')) return;
      saveAll([]); loadSubmissions(); setStatus('All submissions cleared on this device.', 'success');
    }

    // ======= Events =======
    // Tabs
    $('#tabSurvey').addEventListener('click', ()=>{ $('#panelSurvey').classList.remove('hidden'); $('#panelAdmin').classList.add('hidden'); });
    $('#tabAdmin').addEventListener('click', ()=>{ $('#panelAdmin').classList.remove('hidden'); $('#panelSurvey').classList.add('hidden'); loadSubmissions(); });

    // Survey
    $('#clientForm').addEventListener('submit', submitForm);
    $('#phone').addEventListener('input', formatPhoneInput);
    ['#budget','#monthlyPaymentTarget','#monthlyPaymentStretch','#downPayment'].forEach(sel=>{ $(sel).addEventListener('input', onCurrencyInput); $(sel).addEventListener('blur', onCurrencyInput); });
    $('#statusNoRealtor').addEventListener('change', onClientStatusChange);
    $('#statusWithRealtor').addEventListener('change', onClientStatusChange);
    ['#situationRenting','#situationOwning','#situationOther'].forEach(sel=>$(sel).addEventListener('change', onSituationChange));
    $$('#ownerNeedToSellGroup input[name="ownerNeedToSell"]').forEach(r=>r.addEventListener('change', onSellingChange));
    $$('#isUnderContractGroup input[name="isUnderContract"]').forEach(r=>r.addEventListener('change', onUnderContractChange));

    // Admin
    $('#btnRefresh').addEventListener('click', () => { loadSubmissions(); applyAdminFilters(); });
    $('#btnExport').addEventListener('click', exportCSV);
    // Apply filters whenever search or filter inputs change
    $('#searchInput').addEventListener('input', applyAdminFilters);
    $('#adminFilterName').addEventListener('input', applyAdminFilters);
    $('#adminFilterPhone').addEventListener('input', applyAdminFilters);
    $('#adminFilterEmail').addEventListener('input', applyAdminFilters);
    $('#adminFilterStage').addEventListener('change', applyAdminFilters);
    $('#adminFilterStageTop').addEventListener('change', applyAdminFilters);
    $('#adminFilterHeat').addEventListener('change', applyAdminFilters);
    $('#adminFilterNextFollow').addEventListener('change', applyAdminFilters);
    $('#adminFilterSource').addEventListener('change', applyAdminFilters);
    $('#adminFilterType').addEventListener('change', applyAdminFilters);
    $('#drawerBackdrop').addEventListener('click', ()=>$('#drawer').classList.add('hidden'));
    $('#btnCloseDrawer').addEventListener('click', ()=>$('#drawer').classList.add('hidden'));
    $('#btnSaveNotes').addEventListener('click', saveNotes);
    $('#btnDelete').addEventListener('click', deleteCurrent);
    $('#btnClearAll').addEventListener('click', clearAll);

    // Boot
    setNow(); onClientStatusChange(); onSituationChange(); onSellingChange();

    // ======= Admin Toggle =======
    // Define a simple admin password here. In a production system, store this securely.
    const ADMIN_PASSWORD = 'admin123';
    const toggleEl = document.getElementById('toggleAdmin');
    if (toggleEl) {
      toggleEl.addEventListener('change', function() {
        if (this.checked) {
          const userPwd = prompt('Enter admin password:');
          if (userPwd === ADMIN_PASSWORD) {
            // Switch to admin panel
            document.getElementById('panelAdmin').classList.remove('hidden');
            document.getElementById('panelSurvey').classList.add('hidden');
            loadSubmissions();
            applyAdminFilters();
          } else {
            alert('Incorrect password');
            this.checked = false;
          }
        } else {
          // Switch back to survey panel when toggled off
          document.getElementById('panelSurvey').classList.remove('hidden');
          document.getElementById('panelAdmin').classList.add('hidden');
        }
      });
    }
  </script>


</body></html>